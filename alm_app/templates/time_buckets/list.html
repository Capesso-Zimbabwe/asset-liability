{% extends "base.html" %}

{% block title %}Time Buckets{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 fw-bold text-dark mb-1">Time Buckets</h1>
                <p class="text-muted small mb-0">Manage time bucket configurations for reporting periods</p>
            </div>
            {% if buckets %}
            <div class="d-flex gap-2">
                <a href="{% url 'alm_app:time_bucket_manage' %}" class="btn d-flex align-items-center" style="background-color:#0B0920;color:#fff;border:1px solid #0B0920;" onmouseover="this.style.backgroundColor='#231E36'; this.style.borderColor='#231E36';" onmouseout="this.style.backgroundColor='#0B0920'; this.style.borderColor='#0B0920';">
                    <svg width="16" height="16" class="me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Add Buckets
                </a>
                <button onclick="confirmDelete()" class="btn btn-outline-danger d-flex align-items-center">
                    <svg width="16" height="16" class="me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Delete All
                </button>
            </div>
            {% else %}
            <a href="{% url 'alm_app:time_bucket_manage' %}" class="btn d-flex align-items-center" style="background-color:#0B0920;color:#fff;border:1px solid #0B0920;" onmouseover="this.style.backgroundColor='#231E36'; this.style.borderColor='#231E36';" onmouseout="this.style.backgroundColor='#0B0920'; this.style.borderColor='#0B0920';">
                <svg width="16" height="16" class="me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                Create Buckets
            </a>
            {% endif %}
        </div>
    </div>

    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
        <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-danger{% endif %} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Time Buckets List -->
    <div class="card shadow-sm">
        {% if buckets %}
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th class="fw-medium text-muted small text-uppercase">Bucket #</th>
                        <th class="fw-medium text-muted small text-uppercase">Start Date</th>
                        <th class="fw-medium text-muted small text-uppercase">End Date</th>
                        <th class="fw-medium text-muted small text-uppercase">Frequency</th>
                        <th class="fw-medium text-muted small text-uppercase">Multiplier</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bucket in buckets %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0 me-3">
                                    <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                        <svg width="16" height="16" class="text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="fw-medium text-dark">{{ bucket.serial_number }}</div>
                            </div>
                        </td>
                        <td class="text-dark">{{ bucket.start_date|date:"Y-m-d" }}</td>
                        <td class="text-dark">{{ bucket.end_date|date:"Y-m-d" }}</td>
                        <td>
                            <span class="badge bg-success bg-opacity-10 text-success">
                                {{ bucket.frequency }}
                            </span>
                        </td>
                        <td class="text-dark">{{ bucket.multiplier }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="card-body text-center py-5">
            <svg width="48" height="48" class="text-muted mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <h5 class="fw-medium text-dark">No time buckets</h5>
            <p class="text-muted mb-3">Get started by creating time bucket configurations.</p>
            <a href="{% url 'alm_app:time_bucket_manage' %}" class="btn  d-inline-flex align-items-center" style="background-color:#0B0920;color:#fff;border:1px solid #0B0920;" onmouseover="this.style.backgroundColor='#231E36'; this.style.borderColor='#231E36';" onmouseout="this.style.backgroundColor='#0B0920'; this.style.borderColor='#0B0920';">
                <svg width="16" height="16" class="me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                Create Buckets
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
function confirmDelete() {
    if (confirm('Are you sure you want to delete all time buckets? This action cannot be undone.')) {
        fetch('{% url "alm_app:time_bucket_delete" %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        }).then(response => {
            if (response.ok) {
                window.location.reload();
            }
        });
    }
}
</script>
{% endblock %}